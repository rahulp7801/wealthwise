/*globals ccc */

(function($, Backbone, _) {
    'use strict';

    /* DETECT SCHOOL ID TO SHOW SCHOOL THEME */
    var m, cccMisCode, successFn, errorFn, template, templateSettings;

    cccMisCode = $('#cccBrandingCollegeId').val();
    // if not set, try to read it from the cookie...
    if (!cccMisCode) {
        m = document.cookie.match(/cccMisCode=([0-9a-zA-Z]{3})/);
        cccMisCode = m ? m[1].toUpperCase() : "";
    }

    if(cccMisCode.charAt(0) === "0") {
        cccMisCode = cccMisCode.substring(1);
    }

    templateSettings = {
        variable: 'data',
        evaluate:    /\{\{(.+?)\}\}/g,
        interpolate: /\{\{=(.+?)\}\}/g,
        escape:      /\{\{-(.+?)\}\}/g
    };
    template = _.template($('#ccc-portal-logo-template').text(), undefined, templateSettings);

    successFn = function(data) {
        $('.ccc-portal-logo').html(template(data));
    };

    errorFn = function() {
        var defaultData = {
            skinBackground: 'eeeeee',
            skinPosition: null,
            skinLogoURL: "/ccc-jasig-widget-portlets/images/common/portal_logo.png",
            collegeTitle:  "California Community Colleges Chancellor's Office"
        };

        successFn(defaultData);
    };

    if (!cccMisCode) {
        errorFn();
    } else {
        $.ajax({
            url: '/gateway/college/branding/' + cccMisCode,
            type: 'GET'
        }).then(successFn, errorFn);
    }
}) (ccc.jQuery, ccc.Backbone, ccc._);


